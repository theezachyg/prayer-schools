<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21 Days of Prayer for Schools - Registration</title>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://schoolprayer.bridgebuilders.net/">
    <meta property="og:title" content="21 Days of Prayer for Our Nation's Schools">
    <meta property="og:description" content="Join the movement! Adopt a school to pray for during August 1-21, 2025. Together, we can make a difference through prayer.">
    <meta property="og:image" content="https://cdn.prod.website-files.com/642ce3ba6c45ae6f28f9515f/689138cffa79673f9034b6aa_21dofprayerschools.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://schoolprayer.bridgebuilders.net/">
    <meta property="twitter:title" content="21 Days of Prayer for Our Nation's Schools">
    <meta property="twitter:description" content="Join the movement! Adopt a school to pray for during August 1-21, 2025. Together, we can make a difference through prayer.">
    <meta property="twitter:image" content="https://cdn.prod.website-files.com/642ce3ba6c45ae6f28f9515f/689138cffa79673f9034b6aa_21dofprayerschools.png">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0SBB5GCNJN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-0SBB5GCNJN');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Helvetica, Arial, sans-serif;
            background: #113a51;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(135deg, rgba(17, 58, 81, 0.95) 0%, rgba(17, 58, 81, 0.85) 50%, rgba(11, 29, 40, 0.95) 100%),
                url('https://cdn.prod.website-files.com/642ce3ba6c45ae6f28f9515f/68910f53a0e230566c98ba07_PrayerBKG1.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            z-index: -1;
        }

        .page-wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: #113a51;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h1 {
            line-height: 1;
        }

        .subtitle {
            text-align: center;
            color: #36b7ff;
            margin-bottom: 30px;
            font-size: 1.2em;
            font-weight: 300;
            text-transform: none;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #113a51;
            font-weight: bold;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="text"],
        input[type="email"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #d2f8ff;
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: Helvetica, Arial, sans-serif;
            -webkit-appearance: none; /* Better iOS styling */
            appearance: none;
        }

        input[type="text"]:focus,
        input[type="email"]:focus {
            outline: none;
            border-color: #36b7ff;
            background: #f5f5f5;
            box-shadow: 0 0 0 3px rgba(54, 183, 255, 0.1);
        }

        /* Improve mobile input experience */
        @supports (-webkit-touch-callout: none) {
            input[type="text"],
            input[type="email"] {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
        }

        #school-search {
            position: relative;
        }

        #school-input {
            padding-right: 45px;
        }

        .add-school-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #36b7ff;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .add-school-btn:hover {
            background: #ec9e23;
            transform: translateY(-50%) scale(1.05);
        }

        .add-school-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        #manualAddBtn {
            background: none !important;
            border: none !important;
            color: #36b7ff !important;
            cursor: pointer !important;
            font-size: 14px !important;
            text-decoration: underline !important;
            font-family: Helvetica, Arial, sans-serif;
        }

        #manualAddBtn:hover {
            color: #ec9e23 !important;
        }

        #manual-entry {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f5e5c7 !important;
            border-radius: 4px;
            border: 1px solid #ec9e23;
        }

        #addManualSchoolBtn {
            background: #36b7ff !important;
            color: white !important;
            border: none !important;
            padding: 8px 15px !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            margin-right: 10px !important;
            font-family: Helvetica, Arial, sans-serif;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 12px;
            letter-spacing: 1px;
        }

        #addManualSchoolBtn:hover {
            background: #ec9e23 !important;
        }

        #cancelManualBtn {
            background: #d2f8ff !important;
            color: #113a51 !important;
            border: none !important;
            padding: 8px 15px !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            font-family: Helvetica, Arial, sans-serif;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 12px;
            letter-spacing: 1px;
        }

        #cancelManualBtn:hover {
            background: #36b7ff !important;
            color: white !important;
        }

        #selected-schools {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .school-tag {
            display: inline-flex;
            align-items: center;
            background: #36b7ff;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            margin: 5px 5px 5px 0;
            font-size: 14px;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .school-tag .remove {
            margin-left: 10px;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .school-tag .remove:hover {
            opacity: 1;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: #113a51;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            font-family: Helvetica, Arial, sans-serif;
        }

        .submit-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(236,158,35,0.3), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover {
            background: #36b7ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(17, 58, 81, 0.3);
        }

        .submit-btn:hover:before {
            left: 100%;
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn.loading {
            background: #6b7280;
            cursor: not-allowed;
        }

        .submit-btn .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            color: #e53e3e;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 20px;
            background: #2b2b2b;
            color: white;
            border-radius: 4px;
            margin-top: 20px;
            animation: fadeInUp 0.6s ease-out;
            line-height: 1.6;
        }

        .info-text {
            text-align: center;
            color: #113a51;
            font-size: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #d2f8ff;
            border-radius: 4px;
            border-left: 4px solid #36b7ff;
            line-height: 1.5;
        }

        /* Share section styles */
        .share-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .share-title {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #ec9e23;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            text-decoration: none;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .share-btn.facebook {
            background: #1877f2;
        }

        .share-btn.twitter {
            background: #000000;
        }

        .share-btn.email {
            background: #ea4335;
        }

        .share-btn.sms {
            background: #3db854;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            display: inline-block;
            background: #36b7ff;
            color: white;
            padding: 12px 30px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #ec9e23;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

            /* Prayer notification widget - moved to top left */
            .prayer-notification {
                position: fixed;
                top: 80px; /* Just below header */
                left: 20px;
                background: rgba(43, 43, 43, 0.95);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                display: none;
                animation: slideInLeft 0.5s ease-out;
                max-width: 300px;
                border-left: 3px solid #36b7ff;
            }

            @keyframes slideInLeft {
                from {
                    transform: translateX(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutLeft {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(-100%);
                    opacity: 0;
                }
            }

            .prayer-notification.hiding {
                animation: slideOutLeft 0.5s ease-out;
            }

            .prayer-notification-content {
                font-size: 0.9em;
                line-height: 1.4;
            }

            .prayer-notification-content strong {
                color: #ec9e23;
                font-weight: bold;
            }

            .prayer-notification-icon {
                display: inline-block;
                margin-right: 10px;
                color: #36b7ff;
                vertical-align: middle;
            }

            /* Mobile responsive */
            @media (max-width: 768px) {
                .prayer-notification {
                    top: 70px;
                    left: 15px;
                    right: 15px;
                    max-width: none;
                    font-size: 0.85em;
                    padding: 12px 15px;
                }
            }

            @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2em;
            }

            .share-buttons {
                flex-direction: column;
            }

            .share-btn {
                width: 100%;
                justify-content: center;
            }

            .action-buttons {
                flex-direction: column;
                width: 100%;
            }

            .action-btn {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="content-wrapper">
            <div class="container">
                <h1 style="line-height: 1;">
                    <span style="display: block; font-size: 3em; font-weight: 900; margin-bottom: 5px;">21 DAYS</span>
                    <span style="display: block; font-size: 0.9em; font-weight: normal; white-space: nowrap; letter-spacing: 1px;">OF PRAYER FOR SCHOOLS</span>
                </h1>
                <p class="subtitle">August 1-21, 2025</p>
                
                <div class="info-text">
                    <strong>Join us in adopting your local schools for prayer.</strong><br>
                    Whether you're a parent, grandparent, teacher, student, or just someone who cares—commit to prayerwalking, prayerdriving, or interceding from home for the schools you select.
                </div>

                <form id="adoptSchoolForm">
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" name="firstName" placeholder="John" required>
                        <span class="error" id="firstNameError">Please enter your first name</span>
                    </div>

                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" name="lastName" placeholder="Smith" required>
                        <span class="error" id="lastNameError">Please enter your last name</span>
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="jsmith@email.com" required>
                        <span class="error" id="emailError">Please enter a valid email address</span>
                    </div>

                    <div class="form-group">
                        <label for="school-input">Search for Schools</label>
                        <div id="school-search">
                            <input type="text" id="school-input" placeholder="Search for schools...">
                            <button type="button" class="add-school-btn" id="addSchoolBtn" title="Add school">+</button>
                        </div>
                        <div id="no-results-message" style="display: none; margin-top: 10px; padding: 10px; background: #f0f8ff; border: 1px solid #36b7ff; border-radius: 4px;">
                            <div style="font-size: 13px; color: #113a51;">
                                Can't find your school? <a href="#" id="showManualEntryLink" style="color: #36b7ff; text-decoration: underline;">Click here to add it</a>
                            </div>
                        </div>
                        <div id="manual-entry" style="display: none; margin-top: 15px; padding: 15px; background: #f5e5c7; border-radius: 10px; border: 1px solid #ec9e23;">
                            <div style="margin-bottom: 10px; font-size: 14px; color: #113a51;">
                                <strong>Add School Information</strong>
                            </div>
                            <input type="text" id="manual-school-name" placeholder="School name" style="width: 100%; margin-bottom: 10px;">
                            <input type="text" id="manual-school-location" placeholder="City, State" style="width: 100%; margin-bottom: 10px;">
                            <button type="button" id="addManualSchoolBtn" style="background: #36b7ff; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Search & Add School</button>
                            <button type="button" id="cancelManualBtn" style="background: #e0e0e0; color: #666; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">Cancel</button>
                        </div>
                        <div id="selected-schools"></div>
                        <span class="error" id="schoolError">Please select at least one school to pray for</span>
                    </div>

                    <button type="submit" class="submit-btn">Join the Prayer Movement</button>
                </form>

                <div class="success-message" id="successMessage">
                    <div id="personalizedThankYou" style="line-height: 1.3;">
                        <div style="font-size: 1.2em;">Thank you</div>
                        <div style="font-size: 2em; font-weight: bold; color: #ec9e23; margin: 10px 0;" id="userFirstName"></div>
                        <div style="font-size: 1.1em;">for joining the</div>
                        <div style="font-size: 1.4em; font-weight: bold; margin-top: 10px;">21 Days of Prayer for Schools movement!</div>
                    </div>
                    
                    <p style="margin: 15px 0;">You've committed to pray for the schools you selected.</p>
                    
                    <div id="selectedSchoolsList" style="margin: 15px 0; font-weight: bold;"></div>
                    
                    <div style="font-size: 1.5em; font-weight: bold; margin: 20px 0; color: #ec9e23;">August 1-21, 2025</div>

                    <div class="share-section">
                        <div class="share-title">Share Your Commitment</div>
                        <p style="margin-bottom: 15px; font-size: 0.9em; opacity: 0.9;">Let others know which schools you're praying for!</p>
                        
                        <div class="share-buttons">
                            <button class="share-btn facebook" onclick="shareOnFacebook()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                </svg>
                                Facebook
                            </button>
                            <button class="share-btn twitter" onclick="shareOnTwitter()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                </svg>
                                X
                            </button>
                            <button class="share-btn email" onclick="shareViaEmail()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                </svg>
                                Email
                            </button>
                            <button class="share-btn sms" onclick="shareViaSMS()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"/>
                                </svg>
                                Text
                            </button>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <a href="map.html" class="action-btn">View Prayer Map</a>
                        <a href="#" class="action-btn" onclick="location.reload(); return false;">Adopt More Schools</a>
                    </div>
                </div>
            </div>
        </div>

        <footer style="background: #2b2b2b; color: #d2f8ff; padding: 20px; text-align: center; width: 100%;">
            <div style="max-width: 800px; margin: 0 auto;">
                <a href="https://bridgebuilders.net" 
                   target="_blank"
                   style="color: white; text-decoration: none; font-size: 16px;">
                    <span style="font-weight: 900;">BRIDGE</span><span style="font-weight: 300;">BUILDERS</span>
                </a>
                
                <p style="margin: 8px 0; font-size: 12px;">P.O. Box 31415, Phoenix, AZ 85046 USA</p>
                
                <p style="margin: 10px 0; font-size: 11px;">
                    BridgeBuilders Int'l Leadership Network © <span id="currentYear"></span>. All Rights Reserved. Made in Arizona <span style="color: #b24646;">♥</span>
                </p>
                
                <div style="margin-top: 10px;">
                    <a href="https://app.termly.io/policy-viewer/policy.html?policyUUID=42c7b670-3f0d-40ab-8cbe-b952917fb888" 
                       target="_blank" 
                       style="color: #36b7ff; text-decoration: none; margin: 0 10px; font-size: 11px;">
                        Privacy Notice
                    </a>
                    <span style="color: #666; font-size: 11px;">|</span>
                    <a href="#" 
                       onclick="if(window.displayPreferenceModal) {window.displayPreferenceModal();} return false;"
                       style="color: #36b7ff; text-decoration: none; margin: 0 10px; font-size: 11px; cursor: pointer;">
                        Cookie Preferences
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Set current year
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Store user data for sharing
        let currentUserData = {
            firstName: '',
            schools: []
        };

        // Share functions
        function shareOnFacebook() {
            const url = encodeURIComponent(window.location.origin + '/map.html');
            const schoolNames = currentUserData.schools.map(s => s.name).join(', ');
            const text = encodeURIComponent(`I've committed to pray for ${schoolNames} during the 21 Days of Prayer for Our Nation's Schools! Join me in praying for schools in your community. #21DaysOfPrayer #PrayForSchools #ReclaimAGeneration`);
            
            // Facebook doesn't support direct image sharing via URL parameters
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank', 'width=600,height=400');
            
            // Track share
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'event_category': 'social',
                    'event_label': 'facebook',
                    'content_type': 'prayer_commitment'
                });
            }
            
            // Log share to Google Sheets
            logShareActivity('facebook', schoolNames);
        }

        function shareOnTwitter() {
            const url = encodeURIComponent(window.location.origin + '/map.html');
            const schoolNames = currentUserData.schools.map(s => s.name).join(', ');
            // Twitter has character limits, so we might need to truncate
            let tweetText = `I've committed to pray for ${schoolNames} during the 21 Days of Prayer for Our Nation's Schools!`;
            
            // If too long, show count instead
            if (tweetText.length > 200) {
                const schoolCount = currentUserData.schools.length;
                tweetText = `I've committed to pray for ${schoolCount} school${schoolCount > 1 ? 's' : ''} during the 21 Days of Prayer for Our Nation's Schools!`;
            }
            
            const text = encodeURIComponent(`${tweetText} #21DaysOfPrayer #PrayForSchools`);
            window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank', 'width=600,height=400');
            
            // Track share
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'event_category': 'social',
                    'event_label': 'twitter',
                    'content_type': 'prayer_commitment'
                });
            }
            
            // Log share to Google Sheets
            logShareActivity('twitter', schoolNames);
        }

        function shareViaEmail() {
            const schoolsList = currentUserData.schools.map(s => `• ${s.name}`).join('\n');
            const subject = encodeURIComponent('I\'m Praying for Our Schools!');
            const body = encodeURIComponent(
                `Hi,\n\n` +
                `I wanted to share that I've committed to pray for the following schools during the 21 Days of Prayer for Our Nation's Schools (August 1-21, 2025):\n\n` +
                `${schoolsList}\n\n` +
                `I encourage you to join this movement and adopt schools in your community for prayer. ` +
                `You can sign up and see the prayer map here: ${window.location.origin}/map.html\n\n` +
                `Together, we can make a difference through prayer!\n\n` +
                `Blessings,\n${currentUserData.firstName}`
            );
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            
            // Track share
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'event_category': 'social',
                    'event_label': 'email',
                    'content_type': 'prayer_commitment'
                });
            }
            
            // Log share to Google Sheets
            const schoolNames = currentUserData.schools.map(s => s.name).join(', ');
            logShareActivity('email', schoolNames);
        }

        function shareViaSMS() {
            const schoolNames = currentUserData.schools.map(s => s.name).join(', ');
            let smsText = `I've committed to pray for ${schoolNames} during the 21 Days of Prayer!`;
            
            // SMS has character limits, truncate if needed
            if (smsText.length > 100) {
                const schoolCount = currentUserData.schools.length;
                smsText = `I've committed to pray for ${schoolCount} school${schoolCount > 1 ? 's' : ''} during the 21 Days of Prayer!`;
            }
            
            const text = encodeURIComponent(`${smsText} Join me: ${window.location.origin}/map.html`);
            
            // Detect mobile and use appropriate SMS link
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                // iOS
                window.open(`sms:&body=${text}`);
            } else {
                // Android and others
                window.open(`sms:?body=${text}`);
            }
            
            // Track share
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'event_category': 'social',
                    'event_label': 'sms',
                    'content_type': 'prayer_commitment'
                });
            }
            
            // Log share to Google Sheets
            logShareActivity('sms', schoolNames);
        }

        // New function to log share activity to Google Sheets
        function logShareActivity(platform, schools, recipientEmail = '', recipientName = '') {
            if (!GOOGLE_SHEETS_WEB_APP_URL) return;
            
            const shareData = {
                action: 'logShare',
                timestamp: new Date().toISOString(),
                sharer: currentUserData.firstName || 'Anonymous',
                platform: platform,
                schools: schools,
                recipientEmail: recipientEmail,
                recipientName: recipientName
            };
            
            // Send to Google Sheets (fire and forget)
            fetch(GOOGLE_SHEETS_WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(shareData)
            }).catch(error => console.error('Error logging share:', error));
        }
    </script>
    
    <!-- Load configuration -->
    <script src="/config.js"></script>
    
    <script>
        // Get config from data attributes or window object
        const config = window.ENV || {};
        const GOOGLE_MAPS_API_KEY = config.GOOGLE_MAPS_API_KEY || '';
        const GOOGLE_SHEETS_WEB_APP_URL = config.GOOGLE_SHEETS_WEB_APP_URL || '';
        
        // Debug logging
        console.log('Environment config loaded');
        console.log('Maps API Key present:', !!GOOGLE_MAPS_API_KEY);
        console.log('Sheets URL present:', !!GOOGLE_SHEETS_WEB_APP_URL);
        
        // Error handling for missing config
        if (!GOOGLE_MAPS_API_KEY || !GOOGLE_SHEETS_WEB_APP_URL) {
            console.error('Missing required configuration');
            // Show user-friendly error
            const container = document.querySelector('.container');
            if (container) {
                container.innerHTML = `
                    <h1 style="color: #e53e3e;">Configuration Error</h1>
                    <p style="color: #113a51; text-align: center;">
                        We're experiencing technical difficulties. Please try again later or contact support.
                    </p>
                `;
            }
        }
        
        // Load Google Maps API
        function loadGoogleMapsAPI() {
            if (!GOOGLE_MAPS_API_KEY) {
                console.error('Google Maps API key not configured');
                showError('Configuration error. Please contact support.');
                return;
            }
            
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places&callback=initAutocomplete`;
            script.async = true;
            script.defer = true;
            script.onerror = function() {
                console.error('Failed to load Google Maps');
                showError('Failed to load Google Maps. Please refresh the page.');
            };
            document.head.appendChild(script);
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #e53e3e; color: white; padding: 15px 25px; border-radius: 4px; z-index: 9999;';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        let autocomplete;
        let selectedSchools = [];
        let geocoder;

        function initAutocomplete() {
            const input = document.getElementById('school-input');
            
            // Initialize geocoder
            geocoder = new google.maps.Geocoder();
            
            // Create autocomplete with options to search for schools only
            autocomplete = new google.maps.places.Autocomplete(input, {
                types: ['school', 'university'],
                fields: ['name', 'place_id', 'formatted_address']
            });

            // Track if user has typed something
            let hasSearched = false;
            input.addEventListener('input', function() {
                hasSearched = input.value.length > 2;
                // Hide no results message when typing
                document.getElementById('no-results-message').style.display = 'none';
            });

            // Add listener for place selection
            autocomplete.addListener('place_changed', function() {
                const place = autocomplete.getPlace();
                if (place.name) {
                    addSchool(place);
                } else if (hasSearched && input.value.trim()) {
                    // Show "can't find" message only if they've searched
                    document.getElementById('no-results-message').style.display = 'block';
                }
            });

            // Also allow adding on Enter key
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const place = autocomplete.getPlace();
                    if (place && place.name) {
                        addSchool(place);
                    } else if (hasSearched && input.value.trim()) {
                        document.getElementById('no-results-message').style.display = 'block';
                    }
                }
            });
        }

        // Add school button click handler
        document.getElementById('addSchoolBtn').addEventListener('click', function() {
            const place = autocomplete.getPlace();
            if (place && place.name) {
                addSchool(place);
            } else {
                const inputValue = document.getElementById('school-input').value.trim();
                if (inputValue && inputValue.length > 2) {
                    // Show manual entry option
                    document.getElementById('no-results-message').style.display = 'block';
                }
            }
        });

        // Initialize event listeners when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Show manual entry link click handler
            const showManualLink = document.getElementById('showManualEntryLink');
            if (showManualLink) {
                showManualLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('no-results-message').style.display = 'none';
                    document.getElementById('manual-entry').style.display = 'block';
                    
                    // Pre-fill with search term
                    const searchValue = document.getElementById('school-input').value.trim();
                    if (searchValue) {
                        document.getElementById('manual-school-name').value = searchValue;
                    }
                    document.getElementById('manual-school-name').focus();
                });
            }

            // Allow Enter key in manual entry fields
            const manualSchoolName = document.getElementById('manual-school-name');
            if (manualSchoolName) {
                manualSchoolName.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('addManualSchoolBtn').click();
                    }
                });
            }

            const manualSchoolLocation = document.getElementById('manual-school-location');
            if (manualSchoolLocation) {
                manualSchoolLocation.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('addManualSchoolBtn').click();
                    }
                });
            }
        });
        
        // Cancel button handler
        document.getElementById('cancelManualBtn').addEventListener('click', function() {
            document.getElementById('manual-entry').style.display = 'none';
            document.getElementById('manual-school-name').value = '';
            document.getElementById('manual-school-location').value = '';
            document.getElementById('no-results-message').style.display = 'none';
        });

        document.getElementById('addManualSchoolBtn').addEventListener('click', function() {
            const schoolName = document.getElementById('manual-school-name').value.trim();
            const schoolLocation = document.getElementById('manual-school-location').value.trim();
            
            if (!schoolName) {
                alert('Please enter a school name');
                return;
            }

            // Show loading state
            const addBtn = document.getElementById('addManualSchoolBtn');
            const originalText = addBtn.textContent;
            addBtn.textContent = 'Searching Google Places...';
            addBtn.disabled = true;

            // First try to search Google Places API with the provided info
            const service = new google.maps.places.PlacesService(document.createElement('div'));
            const request = {
                query: `${schoolName} ${schoolLocation} school`,
                fields: ['name', 'place_id', 'formatted_address', 'types']
            };

            service.textSearch(request, function(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
                    // Filter for actual schools
                    const schools = results.filter(place => 
                        place.types && (place.types.includes('school') || 
                        place.types.includes('primary_school') || 
                        place.types.includes('secondary_school') ||
                        place.types.includes('university'))
                    );

                    if (schools.length > 0) {
                        // Found potential matches
                        let message = `We found ${schools.length} potential match${schools.length > 1 ? 'es' : ''}:\n\n`;
                        schools.slice(0, 3).forEach((school, index) => {
                            message += `${index + 1}. ${school.name}\n   ${school.formatted_address}\n\n`;
                        });
                        message += 'Would you like to add the first match?';

                        if (confirm(message)) {
                            // Add the first match
                            addSchool(schools[0]);
                            
                            // Clear and hide manual entry
                            document.getElementById('manual-entry').style.display = 'none';
                            document.getElementById('manual-school-name').value = '';
                            document.getElementById('manual-school-location').value = '';
                            document.getElementById('no-results-message').style.display = 'none';
                            document.getElementById('school-input').value = '';
                        }
                    } else {
                        // No school-type results, try geocoding
                        tryGeocodeAndAdd(schoolName, schoolLocation);
                    }
                } else {
                    // No results from Places API, try geocoding
                    tryGeocodeAndAdd(schoolName, schoolLocation);
                }

                // Reset button
                addBtn.textContent = originalText;
                addBtn.disabled = false;
            });
        });

        function tryGeocodeAndAdd(schoolName, schoolLocation) {
            // Try to geocode the address
            const searchQuery = schoolLocation ? `${schoolName}, ${schoolLocation}` : schoolName;
            
            geocoder.geocode({ address: searchQuery }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    // Found a match via geocoding
                    const place = results[0];
                    const formattedAddress = place.formatted_address;
                    
                    // Show what we found
                    const confirmMessage = `We couldn't find this exact school in Google's database, but we found this location:\n\n${schoolName}\n${formattedAddress}\n\nWould you like to add it anyway?`;
                    
                    if (confirm(confirmMessage)) {
                        // Add the geocoded school
                        const geocodedSchool = {
                            name: schoolName,
                            place_id: 'manual_geocoded_' + Date.now(),
                            formatted_address: formattedAddress,
                            address: formattedAddress,
                            isManual: true,
                            location: place.geometry.location
                        };

                        // Check if school already exists
                        if (selectedSchools.some(school => 
                            school.name === schoolName && school.address === formattedAddress)) {
                            alert('This school has already been added.');
                            return;
                        }

                        selectedSchools.push(geocodedSchool);
                        updateSelectedSchoolsDisplay();

                        // Clear and hide manual entry
                        document.getElementById('manual-entry').style.display = 'none';
                        document.getElementById('manual-school-name').value = '';
                        document.getElementById('manual-school-location').value = '';
                        document.getElementById('no-results-message').style.display = 'none';
                        document.getElementById('school-input').value = '';
                        document.getElementById('schoolError').style.display = 'none';
                    }
                } else {
                    // Couldn't find via any method
                    const confirmMessage = `We couldn't find "${schoolName}" in Google's database.\n\nThis might mean:\n• The school name is very different in Google\n• It's a new school not yet in Google\n• There's a typo in the name\n\nWould you still like to add it manually?`;
                    
                    if (confirm(confirmMessage)) {
                        // Add as completely manual entry
                        const manualSchool = {
                            name: schoolName,
                            place_id: 'manual_' + Date.now(),
                            address: schoolLocation || 'Location not specified',
                            formatted_address: schoolLocation || 'Location not specified',
                            isManual: true
                        };

                        // Check if school already exists
                        if (selectedSchools.some(school => 
                            school.name === schoolName && school.address === manualSchool.address)) {
                            alert('This school has already been added.');
                            return;
                        }

                        selectedSchools.push(manualSchool);
                        updateSelectedSchoolsDisplay();

                        // Clear and hide manual entry
                        document.getElementById('manual-entry').style.display = 'none';
                        document.getElementById('manual-school-name').value = '';
                        document.getElementById('manual-school-location').value = '';
                        document.getElementById('no-results-message').style.display = 'none';
                        document.getElementById('school-input').value = '';
                        document.getElementById('schoolError').style.display = 'none';
                    }
                }
            });
        }

        function addSchool(place) {
            // Check if school is already selected
            if (selectedSchools.some(school => school.place_id === place.place_id)) {
                alert('This school has already been selected.');
                return;
            }

            // Add to selected schools
            selectedSchools.push({
                name: place.name,
                place_id: place.place_id,
                address: place.formatted_address || '',
                formatted_address: place.formatted_address || ''
            });

            // Update display
            updateSelectedSchoolsDisplay();
            
            // Clear input
            document.getElementById('school-input').value = '';
            
            // Clear error if shown
            document.getElementById('schoolError').style.display = 'none';
            
            // Hide no results message if shown
            document.getElementById('no-results-message').style.display = 'none';
        }

        function updateSelectedSchoolsDisplay() {
            const container = document.getElementById('selected-schools');
            container.innerHTML = '';

            selectedSchools.forEach((school, index) => {
                const tag = document.createElement('div');
                tag.className = 'school-tag';
                tag.innerHTML = `
                    ${school.name}${school.isManual ? ' (Manual)' : ''}
                    <span class="remove" onclick="removeSchool(${index})">&times;</span>
                `;
                container.appendChild(tag);
            });
        }

        function removeSchool(index) {
            selectedSchools.splice(index, 1);
            updateSelectedSchoolsDisplay();
        }

        // Form validation and submission
        document.getElementById('adoptSchoolForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Reset errors
            document.querySelectorAll('.error').forEach(error => error.style.display = 'none');
            
            // Validate form
            let isValid = true;
            
            const firstName = document.getElementById('firstName').value.trim();
            if (!firstName) {
                document.getElementById('firstNameError').style.display = 'block';
                isValid = false;
            }
            
            const lastName = document.getElementById('lastName').value.trim();
            if (!lastName) {
                document.getElementById('lastNameError').style.display = 'block';
                isValid = false;
            }
            
            const email = document.getElementById('email').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                document.getElementById('emailError').style.display = 'block';
                isValid = false;
            }
            
            if (selectedSchools.length === 0) {
                document.getElementById('schoolError').style.display = 'block';
                isValid = false;
            }
            
            if (isValid) {
                // Check if URL is configured
                if (!GOOGLE_SHEETS_WEB_APP_URL) {
                    showError('Configuration error. Please contact support.');
                    return;
                }
                
                // Store user data for sharing
                currentUserData = {
                    firstName: firstName,
                    schools: selectedSchools
                };
                
                // Disable submit button and show loading state
                const submitBtn = document.querySelector('.submit-btn');
                submitBtn.disabled = true;
                submitBtn.classList.add('loading');
                submitBtn.innerHTML = '<span class="spinner"></span>Joining the movement...';
                
                // Track form submission
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'form_submit', {
                        'event_category': 'engagement',
                        'event_label': 'prayer_registration',
                        'value': selectedSchools.length
                    });
                }
                
                // Prepare data for Google Sheets
                const formData = {
                    timestamp: new Date().toISOString(),
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    schools: selectedSchools.map(school => ({
                        name: school.name,
                        address: school.address || school.formatted_address || '',
                        type: school.isManual ? 'Manual Entry' : 'Google Places'
                    }))
                };
                
                // Send to Google Sheets
                fetch(GOOGLE_SHEETS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Important for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(() => {
                    // Track successful submission
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'form_success', {
                            'event_category': 'engagement',
                            'event_label': 'prayer_registration_complete'
                        });
                    }
                    
                    // Personalize the thank you message with proper formatting
                    document.getElementById('userFirstName').textContent = firstName;
                    
                    // Display the selected schools
                    const schoolsList = selectedSchools.map(school => school.name).join(', ');
                    document.getElementById('selectedSchoolsList').textContent = schoolsList;
                    
                    // Show success message
                    document.getElementById('adoptSchoolForm').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                })
                .catch((error) => {
                    console.error('Error:', error);
                    showError('There was an error submitting your form. Please try again.');
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('loading');
                    submitBtn.innerHTML = 'Join the Prayer Movement';
                    
                    // Track error
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'form_error', {
                            'event_category': 'errors',
                            'event_label': 'prayer_registration_failed'
                        });
                    }
                });
            }
        });

        // Initialize Google Maps when page loads
        window.addEventListener('load', loadGoogleMapsAPI);

        // Prayer notification system for registration page
        async function loadPrayerNotifications() {
            if (!GOOGLE_MAPS_API_KEY || !config.SHEET_ID) {
                return;
            }

            const SHEETS_API_URL = `https://sheets.googleapis.com/v4/spreadsheets/${config.SHEET_ID}/values/Sheet1?key=${GOOGLE_MAPS_API_KEY}`;
            
            try {
                const response = await fetch(SHEETS_API_URL);
                const data = await response.json();
                
                if (data.values && data.values.length > 1) {
                    const notifications = [];
                    const dataRows = data.values.slice(1); // Skip header
                    
                    dataRows.forEach(row => {
                        const firstName = row[1]; // First name column
                        const schoolName = row[4]; // School name column
                        
                        if (firstName && schoolName) {
                            notifications.push({
                                name: firstName,
                                school: schoolName
                            });
                        }
                    });

                    // Shuffle notifications
                    const shuffled = notifications.sort(() => Math.random() - 0.5);
                    
                    if (shuffled.length > 0) {
                        startNotificationCycle(shuffled);
                    }
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        let notificationIndex = 0;
        let notificationInterval;

        function startNotificationCycle(notifications) {
            // Wait 5 seconds after page load
            setTimeout(() => {
                showNotification(notifications);
                
                // Show a new notification every 15-20 seconds
                notificationInterval = setInterval(() => {
                    showNotification(notifications);
                }, 15000 + Math.random() * 5000);
            }, 5000);
        }

        function showNotification(notifications) {
            const notification = document.getElementById('prayerNotification');
            const textElement = document.getElementById('prayerNotificationText');

            // Hide current notification
            notification.classList.add('hiding');

            setTimeout(() => {
                // Update content
                const current = notifications[notificationIndex];
                textElement.innerHTML = `<strong>${current.name}</strong> is praying for ${current.school}`;

                // Show notification
                notification.classList.remove('hiding');
                notification.style.display = 'block';

                // Move to next
                notificationIndex = (notificationIndex + 1) % notifications.length;

                // Hide after 5 seconds
                setTimeout(() => {
                    notification.classList.add('hiding');
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 500);
                }, 5000);
            }, 500);
        }

        // Load notifications when page loads
        window.addEventListener('load', () => {
            loadPrayerNotifications();
        });
    </script>
</body>
</html>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Media Resources - 21 Days of Prayer for Schools</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://schoolprayer.bridgebuilders.net/media"
    />
    <meta
      property="og:title"
      content="Media Resources - 21 Days of Prayer for Our Nation's Schools"
    />
    <meta
      property="og:description"
      content="Access prayer maps, statistics, and media resources for the 21 Days of Prayer movement."
    />
    <meta
      property="og:image"
      content="https://cdn.prod.website-files.com/642ce3ba6c45ae6f28f9515f/689138cffa79673f9034b6aa_21dofprayerschools.png"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          sans-serif;
        background: #f8f9fa;
        color: #113a51;
        line-height: 1.6;
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #113a51 0%, #1e5173 100%);
        color: white;
        padding: 2rem 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 2rem;
      }

      .logo {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .logo span:first-child {
        font-weight: 900;
      }

      .logo span:last-child {
        font-weight: 300;
        opacity: 0.9;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        font-weight: 700;
      }

      .subtitle {
        font-size: 1.2rem;
        opacity: 0.95;
      }

      /* Navigation */
      .nav-bar {
        background: white;
        border-bottom: 1px solid #e0e0e0;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .nav-content {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 2rem;
        display: flex;
        gap: 2rem;
        align-items: center;
      }

      .nav-link {
        color: #113a51;
        text-decoration: none;
        padding: 1rem 0;
        font-weight: 500;
        transition: color 0.3s;
      }

      .nav-link:hover {
        color: #36b7ff;
      }

      .nav-link.active {
        color: #36b7ff;
        border-bottom: 2px solid #36b7ff;
      }

      /* Main Content */
      .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 3rem 2rem;
      }

      /* Stats Section */
      .stats-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .stat-card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        text-align: center;
        transition: transform 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.12);
      }

      .stat-number {
        font-size: 3rem;
        font-weight: 700;
        color: #36b7ff;
        margin-bottom: 0.5rem;
      }

      .stat-label {
        font-size: 1.1rem;
        color: #666;
      }

      .stat-loading {
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #36b7ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      /* Map Section */
      .map-section {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        margin-bottom: 3rem;
      }

      .section-header {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
      }

      .section-title {
        font-size: 2rem;
        color: #113a51;
        margin-bottom: 0.5rem;
      }

      .section-description {
        color: #666;
        font-size: 1.1rem;
      }

      #canvas-container {
        position: relative;
        width: 100%;
        background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
        border-radius: 8px;
        padding: 2rem;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 400px;
      }

      #canvas {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        display: none;
      }

      /* Loading State */
      #loading {
        text-align: center;
        color: white;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.2);
        border-top-color: #36b7ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Action Buttons */
      .action-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #36b7ff 0%, #2a9fdd 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(54, 183, 255, 0.3);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #ec9e23 0%, #d88a1f 100%);
      }

      .btn-secondary:hover {
        box-shadow: 0 5px 15px rgba(236, 158, 35, 0.3);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        opacity: 0.7;
      }

      /* Info Sections */
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .info-card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      }

      .info-card h3 {
        color: #113a51;
        margin-bottom: 1rem;
        font-size: 1.5rem;
      }

      .info-card p {
        color: #666;
        margin-bottom: 1rem;
      }

      .info-card ul {
        list-style: none;
        padding: 0;
      }

      .info-card li {
        padding: 0.5rem 0;
        color: #666;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .info-card li:before {
        content: "âœ“";
        color: #36b7ff;
        font-weight: bold;
      }

      /* Media Kit Section */
      .media-kit {
        background: #113a51;
        color: white;
        padding: 3rem 2rem;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 3rem;
      }

      .media-kit h2 {
        font-size: 2rem;
        margin-bottom: 1rem;
      }

      .media-kit p {
        font-size: 1.1rem;
        margin-bottom: 2rem;
        opacity: 0.95;
      }

      /* Footer */
      footer {
        background: #1a1a1a;
        color: #d2f8ff;
        padding: 3rem 2rem 2rem;
        margin-top: 5rem;
      }

      .footer-content {
        max-width: 1280px;
        margin: 0 auto;
        text-align: center;
      }

      .footer-logo {
        color: white;
        text-decoration: none;
        font-size: 1.5rem;
        display: inline-block;
        margin-bottom: 1rem;
      }

      .footer-logo span:first-child {
        font-weight: 900;
      }

      .footer-logo span:last-child {
        font-weight: 300;
        opacity: 0.8;
      }

      footer p {
        margin: 0.5rem 0;
        font-size: 0.9rem;
        opacity: 0.8;
      }

      footer a {
        color: #36b7ff;
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      /* Responsive */
      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }

        .stat-number {
          font-size: 2.5rem;
        }

        .nav-content {
          overflow-x: auto;
          padding: 0 1rem;
        }

        .container {
          padding: 2rem 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo"><span>BRIDGE</span><span>BUILDERS</span></div>
        <h1>Media Resources</h1>
        <p class="subtitle">21 Days of Prayer for Our Nation's Schools</p>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-bar">
      <div class="nav-content">
        <a href="index.html" class="nav-link">Home</a>
        <a href="map.html" class="nav-link">Live Map</a>
        <a href="#" class="nav-link active">Media Resources</a>
        <a href="homepage.html" class="nav-link">About</a>
      </div>
    </nav>

    <div class="container">
      <!-- Statistics Section -->
      <div class="stats-section">
        <div class="stat-card">
          <div id="school-count-stat" class="stat-number">
            <div class="stat-loading"></div>
          </div>
          <div class="stat-label">Schools Being Prayed For</div>
        </div>
        <div class="stat-card">
          <div id="people-count-stat" class="stat-number">
            <div class="stat-loading"></div>
          </div>
          <div class="stat-label">Prayer Warriors</div>
        </div>
        <div class="stat-card">
          <div id="states-count-stat" class="stat-number">50</div>
          <div class="stat-label">States Participating</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">Aug - May</div>
          <div class="stat-label">Academic Year Focus</div>
        </div>
      </div>

      <!-- Information Cards -->
      <div class="info-grid">
        <div class="info-card">
          <h3>About the Movement</h3>
          <p>
            The 21 Days of Prayer for Our Nation's Schools is a nationwide
            initiative mobilizing communities to pray for students, teachers,
            and administrators throughout the academic year, with special focus
            on recruiting prayer warriors each August.
          </p>
          <p>
            Parents and believers today are deeply concerned about what we see
            happening in schools around our nation. But we can be confident the
            Lord has a great plan for this generation! We can help reclaim it
            through prayer!
          </p>
          <p>
            Since its inception, this movement has united thousands of prayer
            warriors across America, creating a spiritual covering over our
            educational institutions.
          </p>
        </div>

        <div class="info-card">
          <h3>Key Information</h3>
          <ul>
            <li>Academic year prayer focus: August through May</li>
            <li>Special recruiting emphasis each August</li>
            <li>Based on the book "Reclaim a Generation"</li>
            <li>Each participant "adopts" specific schools</li>
            <li>21-day prayer guide with targeted Scriptures</li>
            <li>Resources for churches and prayer groups</li>
            <li>Real-time tracking of prayer coverage</li>
          </ul>
        </div>

        <div class="info-card">
          <h3>Media Contact</h3>
          <p>
            <strong>Cheryl Sacks</strong><br />
            Author & Prayer Mobilizer
          </p>
          <p><strong>BridgeBuilders Int'l Leadership Network</strong></p>
          <p>
            Phone: <strong>+1 (602) 977-1111</strong><br />
            Email:
            <a href="mailto:cheryl.sacks@bridgebuilders.net"
              >cheryl.sacks@bridgebuilders.net</a
            >
          </p>
          <p style="margin-top: 1rem">
            P.O. Box 31415<br />Phoenix, AZ 85046 USA
          </p>
          <p>
            Website:
            <a href="https://prayerforschools.com" target="_blank"
              >prayerforschools.com</a
            >
          </p>
        </div>
      </div>

      <!-- Reclaim a Generation Book Section -->
      <div
        class="map-section"
        style="
          background: linear-gradient(135deg, #113a51 0%, #1e5173 100%);
          color: white;
        "
      >
        <div
          class="section-header"
          style="border-bottom: 2px solid rgba(255, 255, 255, 0.2)"
        >
          <h2 class="section-title" style="color: white">
            Reclaim a Generation
          </h2>
          <p
            class="section-description"
            style="color: rgba(255, 255, 255, 0.9)"
          >
            The foundational resource for the 21 Days of Prayer movement
          </p>
        </div>

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            align-items: start;
          "
        >
          <div>
            <div
              style="
                background: white;
                padding: 1rem;
                border-radius: 8px;
                text-align: center;
              "
            >
              <h3 style="color: #113a51; margin-bottom: 1rem">Prayer Guide</h3>
              <div
                style="background: #f0f0f0; padding: 2rem; border-radius: 4px"
              >
                <p style="color: #666; font-size: 3rem; margin: 0">ðŸ“˜</p>
                <p style="color: #113a51; font-weight: bold; margin-top: 1rem">
                  Volume 2
                </p>
              </div>
            </div>
          </div>

          <div>
            <p
              style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem"
            >
              <strong
                >Parents and believers today are deeply concerned about what we
                see happening in schools around our nation. Clearly Satan has
                declared war on children and youth, and schools are a prime
                target of his. But the truth is that no matter what we see with
                our natural eyes, we can be confident the Lord has a great plan
                for this generation! We can help reclaim it through
                prayer!</strong
              >
            </p>

            <p style="line-height: 1.8; margin-bottom: 1.5rem">
              <em><strong>Reclaim a Generation (Volume 2)</strong></em> is a
              21-day prayer guide, loaded with relevant information about the
              issues schools and kids face today. It includes targeted prayer
              points and Scriptures to pray through each day. While it can be
              used any time throughout the year, it is especially effective to
              use when kids are going back to school after summer break.
            </p>

            <p style="line-height: 1.8; margin-bottom: 1.5rem">
              Pray for a school that's on your heartâ€”maybe the school you
              attended, your child's or grandchild's school, or one in your
              neighborhood. Better yet... get your entire church or prayer group
              to pray through this guide with you!
            </p>

            <p style="line-height: 1.8; margin-bottom: 2rem">
              <em><strong>Reclaim a Generation (Volume 2)</strong></em> also
              includes tips for churches on how to bless schools and kids with
              prayer in unique ways while they are praying through this guide as
              a congregation.
            </p>

            <div
              style="
                background: rgba(255, 255, 255, 0.1);
                padding: 1.5rem;
                border-radius: 8px;
                margin-top: 2rem;
              "
            >
              <h4 style="color: #ffd700; margin-bottom: 1rem">
                About the Author
              </h4>
              <p style="line-height: 1.8">
                <strong>CHERYL SACKS</strong> is a best-selling author, national
                conference speaker, prayer mobilizer, and church prayer
                consultant. Her "Prayer-Saturated" seriesâ€”including
                <em>The Prayer-Saturated Church</em> (NavPress/Tyndale),
                <em>Prayer-Saturated Kids</em> (NavPress/Tyndale), and
                <em>The Prayer-Saturated Family</em>
                (Chosen)â€”have blessed and mentored tens of thousands of
                individuals to go deeper into prayer, and have greatly impacted
                thousands of churches.
              </p>
            </div>

            <div style="margin-top: 2rem">
              <a
                href="homepage.html"
                class="btn"
                style="
                  background: linear-gradient(135deg, #ec9e23 0%, #d88a1f 100%);
                "
              >
                Learn More About Resources
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Map Section -->
      <div class="map-section">
        <div class="section-header">
          <h2 class="section-title">Interactive Prayer Map</h2>
          <p class="section-description">
            High-resolution visualization of schools being prayed for across the
            United States. Perfect for presentations, reports, and social media
            sharing.
          </p>
        </div>

        <div id="canvas-container">
          <div id="loading">
            <div class="spinner"></div>
            <p>Loading prayer map data...</p>
          </div>
          <canvas id="canvas" width="3840" height="2160"></canvas>
        </div>

        <div class="action-buttons">
          <button class="btn" onclick="exportMap()" id="export-btn" disabled>
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
            </svg>
            Download 4K Image
          </button>
          <button
            class="btn btn-secondary"
            onclick="reloadData()"
            id="refresh-btn"
            disabled
          >
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
              />
            </svg>
            Refresh Data
          </button>
          <a href="map.html" class="btn btn-secondary">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
              />
            </svg>
            View Live Map
          </a>
        </div>
      </div>

      <!-- Media Kit Section -->
      <div class="media-kit">
        <h2>Need Additional Resources?</h2>
        <p>
          We have prayer guides, promotional materials, and additional resources
          available for churches, schools, and media organizations.
        </p>
        <a
          href="mailto:info@bridgebuilders.net?subject=Media%20Resources%20Request"
          class="btn"
        >
          Request Media Kit
        </a>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="footer-content">
        <a
          href="https://bridgebuilders.net"
          target="_blank"
          class="footer-logo"
        >
          <span>BRIDGE</span><span>BUILDERS</span>
        </a>
        <p>P.O. Box 31415, Phoenix, AZ 85046 USA</p>
        <p>
          BridgeBuilders Int'l Leadership Network Â©
          <span id="currentYear"></span>. All Rights Reserved.
        </p>
        <p style="margin-top: 1rem">
          <a href="https://bridgebuilders.net" target="_blank"
            >bridgebuilders.net</a
          >
          |
          <a href="https://prayerforschools.com" target="_blank"
            >prayerforschools.com</a
          >
        </p>
      </div>
    </footer>

    <!-- Load configuration -->
    <script src="/config.js"></script>

    <script>
      // Get config from environment variables
      const config = window.ENV || {};

      // Check for required configuration
      if (!config.GOOGLE_MAPS_API_KEY || !config.SHEET_ID) {
        console.error("Missing required configuration");
        document.getElementById("loading").innerHTML = `
				<p style="color: #ff6b6b;">Configuration Error</p>
				<p style="font-size: 14px;">Missing API configuration. Please ensure environment variables are set.</p>
			`;
      }

      // Google Sheets API URL
      const SHEETS_API_URL =
        config.SHEET_ID && config.GOOGLE_MAPS_API_KEY
          ? `https://sheets.googleapis.com/v4/spreadsheets/${config.SHEET_ID}/values/Sheet1?key=${config.GOOGLE_MAPS_API_KEY}`
          : null;

      const width = 3840;
      const height = 2160;
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Set canvas display size (scaled for viewport)
      function resizeCanvas() {
        const container = document.getElementById("canvas-container");
        const maxWidth = container.clientWidth - 64; // Account for padding
        const scale = Math.min(maxWidth / width, 0.3); // Max 30% of original size
        canvas.style.width = width * scale + "px";
        canvas.style.height = height * scale + "px";
      }

      window.addEventListener("resize", resizeCanvas);

      // Map styling
      const bgColor = "#0a0e27";
      const landColor = "#1a2f4a";
      const strokeColor = "#2a4a7a";
      const pointColor = "#FFD700";
      const glowColor = "#FFA500";

      // Load data from Google Sheets
      async function loadSchoolData() {
        console.log("Loading school data from Google Sheets...");

        if (!SHEETS_API_URL) {
          showError("Configuration not loaded. Please refresh the page.");
          return;
        }

        try {
          const response = await fetch(SHEETS_API_URL);
          if (!response.ok) {
            if (response.status === 400) {
              throw new Error(
                "Invalid API configuration. Please check API key and Sheet ID.",
              );
            }
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          console.log("Data loaded successfully");

          if (data.values && data.values.length > 1) {
            await processSheetData(data.values);
          } else {
            throw new Error("No data found in sheet");
          }
        } catch (error) {
          showError("Error loading data: " + error.message);
          console.error("Error details:", error);
        }
      }

      async function processSheetData(rows) {
        try {
          console.log(`Processing ${rows.length - 1} rows of data...`);

          // Skip header row
          const dataRows = rows.slice(1);
          const schools = [];
          const uniquePeople = new Set();
          const uniqueSchools = new Set();

          // Process each row
          dataRows.forEach((row, index) => {
            const lat = parseFloat(row[7]); // Latitude column H
            const lng = parseFloat(row[8]); // Longitude column I
            const schoolName = row[4]; // School Name
            const schoolAddress = row[5]; // School Address
            const personEmail = row[3]; // Email for unique person count

            if (personEmail) {
              uniquePeople.add(personEmail.toLowerCase());
            }

            if (schoolName && schoolAddress) {
              uniqueSchools.add(`${schoolName}|${schoolAddress}`);
            }

            if (!isNaN(lat) && !isNaN(lng) && lat && lng) {
              schools.push({
                name: schoolName,
                address: schoolAddress,
                latitude: lat,
                longitude: lng,
              });
            }
          });

          // Update statistics
          document.getElementById("school-count-stat").textContent =
            uniqueSchools.size.toLocaleString();
          document.getElementById("people-count-stat").textContent =
            uniquePeople.size.toLocaleString();

          console.log(`Found ${schools.length} schools with valid coordinates`);

          if (schools.length === 0) {
            throw new Error("No schools with valid coordinates found");
          }

          // Load US topology
          const us = await d3.json(
            "https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json",
          );

          // Filter for US schools (including Alaska and Hawaii)
          const usSchools = schools.filter((d) => {
            // Continental US
            if (
              d.latitude > 24 &&
              d.latitude < 50 &&
              d.longitude > -125 &&
              d.longitude < -66
            )
              return true;
            // Alaska
            if (
              d.latitude > 51 &&
              d.latitude < 72 &&
              (d.longitude < -130 || d.longitude > 170)
            )
              return true;
            // Hawaii
            if (
              d.latitude > 18 &&
              d.latitude < 23 &&
              d.longitude > -161 &&
              d.longitude < -154
            )
              return true;
            return false;
          });

          console.log(
            `${usSchools.length} schools in US (including Alaska and Hawaii)`,
          );

          // Hide loading and show canvas
          document.getElementById("loading").style.display = "none";
          canvas.style.display = "block";
          document.getElementById("export-btn").disabled = false;
          document.getElementById("refresh-btn").disabled = false;
          resizeCanvas();

          // Setup projection - Albers USA for beautiful US visualization
          const projection = d3
            .geoAlbersUsa()
            .scale(4000)
            .translate([width / 2, height / 2]);

          const path = d3.geoPath().projection(projection).context(ctx);

          // Clear and set background
          ctx.fillStyle = bgColor;
          ctx.fillRect(0, 0, width, height);

          // Draw land masses
          ctx.fillStyle = landColor;
          ctx.strokeStyle = strokeColor;
          ctx.lineWidth = 2;

          // Draw states
          const land = topojson.feature(us, us.objects.states);
          ctx.beginPath();
          path(land);
          ctx.fill();
          ctx.stroke();

          // Draw state borders
          ctx.strokeStyle = strokeColor;
          ctx.lineWidth = 1;
          ctx.globalAlpha = 0.5;
          ctx.beginPath();
          path(topojson.mesh(us, us.objects.states, (a, b) => a !== b));
          ctx.stroke();
          ctx.globalAlpha = 1;

          // Create point density map for glow effect
          const pointDensity = {};
          usSchools.forEach((school) => {
            const coords = projection([school.longitude, school.latitude]);
            if (coords) {
              const key = `${Math.round(coords[0] / 20)}_${Math.round(coords[1] / 20)}`;
              pointDensity[key] = (pointDensity[key] || 0) + 1;
            }
          });

          // Draw schools with glow effect
          ctx.shadowBlur = 0;

          // First pass - draw glow for dense areas
          ctx.globalCompositeOperation = "screen";
          ctx.globalAlpha = 0.15;

          usSchools.forEach((school) => {
            const coords = projection([school.longitude, school.latitude]);
            if (coords) {
              const key = `${Math.round(coords[0] / 20)}_${Math.round(coords[1] / 20)}`;
              const density = pointDensity[key] || 1;

              if (density > 3) {
                ctx.beginPath();
                ctx.fillStyle = glowColor;
                ctx.arc(
                  coords[0],
                  coords[1],
                  Math.min(density * 3, 30),
                  0,
                  2 * Math.PI,
                );
                ctx.fill();
              }
            }
          });

          // Second pass - draw actual points
          ctx.globalCompositeOperation = "source-over";
          ctx.globalAlpha = 1;

          usSchools.forEach((school) => {
            const coords = projection([school.longitude, school.latitude]);
            if (coords) {
              // Draw point
              ctx.beginPath();
              ctx.fillStyle = pointColor;
              ctx.arc(coords[0], coords[1], 3, 0, 2 * Math.PI);
              ctx.fill();

              // Add subtle glow
              ctx.globalAlpha = 0.3;
              ctx.beginPath();
              ctx.fillStyle = glowColor;
              ctx.arc(coords[0], coords[1], 6, 0, 2 * Math.PI);
              ctx.fill();
              ctx.globalAlpha = 1;
            }
          });

          // Add decorative border
          ctx.strokeStyle = "rgba(255,255,255,0.1)";
          ctx.lineWidth = 4;
          ctx.strokeRect(2, 2, width - 4, height - 4);

          // Add branding and footer information in bottom right
          const now = new Date();
          const dateStr = now.toLocaleDateString("en-US", {
            month: "long",
            day: "numeric",
            year: "numeric",
          });

          // Add semi-transparent background for bottom right corner - LARGER
          ctx.fillStyle = "rgba(10, 14, 39, 0.85)";
          const boxWidth = 600;
          const boxHeight = 200;
          const boxX = width - boxWidth - 40;
          const boxY = height - boxHeight - 40;

          // Rounded rectangle for background
          ctx.beginPath();
          ctx.moveTo(boxX + 15, boxY);
          ctx.lineTo(boxX + boxWidth - 15, boxY);
          ctx.quadraticCurveTo(
            boxX + boxWidth,
            boxY,
            boxX + boxWidth,
            boxY + 15,
          );
          ctx.lineTo(boxX + boxWidth, boxY + boxHeight - 15);
          ctx.quadraticCurveTo(
            boxX + boxWidth,
            boxY + boxHeight,
            boxX + boxWidth - 15,
            boxY + boxHeight,
          );
          ctx.lineTo(boxX + 15, boxY + boxHeight);
          ctx.quadraticCurveTo(
            boxX,
            boxY + boxHeight,
            boxX,
            boxY + boxHeight - 15,
          );
          ctx.lineTo(boxX, boxY + 15);
          ctx.quadraticCurveTo(boxX, boxY, boxX + 15, boxY);
          ctx.closePath();
          ctx.fill();

          // Center position for text in the box
          const centerX = boxX + boxWidth / 2;

          // Add BridgeBuilders branding - LARGER SIZES
          ctx.textAlign = "center";
          ctx.fillStyle = "white";

          // BridgeBuilders logo text - INCREASED SIZE
          ctx.font =
            '900 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
          const bridgeText = "BRIDGE";
          const bridgeWidth = ctx.measureText(bridgeText).width;

          ctx.font =
            '300 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
          const buildersText = "BUILDERS";
          const buildersWidth = ctx.measureText(buildersText).width;

          const totalWidth = bridgeWidth + buildersWidth;
          const startX = centerX - totalWidth / 2;

          // Draw BRIDGE in bold
          ctx.font =
            '900 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
          ctx.fillText(bridgeText, startX + bridgeWidth / 2, boxY + 50);

          // Draw BUILDERS in light
          ctx.font =
            '300 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
          ctx.fillStyle = "rgba(255, 255, 255, 0.95)";
          ctx.fillText(
            buildersText,
            startX + bridgeWidth + buildersWidth / 2,
            boxY + 50,
          );

          // Add "Int'l Leadership Network" - LARGER
          ctx.font =
            '26px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
          ctx.fillStyle = "rgba(255, 255, 255, 0.85)";
          ctx.textAlign = "center";
          ctx.fillText("Int'l Leadership Network", centerX, boxY + 90);

          // Add website URL - LARGER
          ctx.font =
            'italic 32px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
          ctx.fillStyle = "#FFD700"; // Golden color for URL
          ctx.fillText("prayerforschools.com", centerX, boxY + 135);

          // Add generated date - LARGER
          ctx.font =
            '22px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
          ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
          ctx.fillText(`Generated: ${dateStr}`, centerX, boxY + 170);

          console.log("Map rendered successfully!");
        } catch (error) {
          showError("Error processing data: " + error.message);
          console.error(error);
        }
      }

      function showError(message) {
        const loadingEl = document.getElementById("loading");
        loadingEl.innerHTML = `
				<p style="color: #ff6b6b; font-size: 1.2rem;">Error</p>
				<p style="font-size: 1rem; margin-top: 1rem;">${message}</p>
			`;
      }

      function exportMap() {
        const exportBtn = document.getElementById("export-btn");
        exportBtn.disabled = true;
        exportBtn.innerHTML =
          '<span class="stat-loading" style="width: 20px; height: 20px; border-width: 2px;"></span> Generating...';

        canvas.toBlob(
          (blob) => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            const date = new Date().toISOString().split("T")[0];
            a.download = `21_Days_Prayer_Schools_Map_4K_${date}.png`;
            a.click();
            URL.revokeObjectURL(url);

            exportBtn.disabled = false;
            exportBtn.innerHTML = `
					<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
						<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
					</svg>
					Download 4K Image
				`;
          },
          "image/png",
          1.0,
        );
      }

      function reloadData() {
        document.getElementById("loading").style.display = "block";
        document.getElementById("loading").innerHTML = `
				<div class="spinner"></div>
				<p>Refreshing data...</p>
			`;
        canvas.style.display = "none";
        document.getElementById("export-btn").disabled = true;
        document.getElementById("refresh-btn").disabled = true;

        loadSchoolData();
      }

      // Set current year in footer
      document.getElementById("currentYear").textContent =
        new Date().getFullYear();

      // Initialize on page load
      window.addEventListener("load", () => {
        // Wait a moment for config to load
        setTimeout(() => {
          if (config.GOOGLE_MAPS_API_KEY && config.SHEET_ID) {
            loadSchoolData();
          } else {
            console.error("Configuration not available");
            showError(
              "Configuration not loaded. Please ensure you're accessing this from the deployed site.",
            );
          }
        }, 100);
      });
    </script>
  </body>
</html>
